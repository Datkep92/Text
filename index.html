# Hệ Thống Quản Lý Hóa Đơn & Tồn Kho Từ File Upload

Dưới đây là hệ thống cho phép upload file hóa đơn PDF, tự động trích xuất dữ liệu và quản lý tồn kho:

```html
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Lý Hóa Đơn & Tồn Kho</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            display: flex;
            gap: 20px;
        }
        .upload-section, .inventory-section {
            flex: 1;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .upload-area {
            border: 2px dashed #3498db;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        .upload-area:hover {
            background-color: #f0f8ff;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .editable {
            background-color: #ffffcc;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 5px;
            box-sizing: border-box;
        }
        .invoice-info {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .search-box {
            margin-bottom: 20px;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Hệ Thống Quản Lý Hóa Đơn & Tồn Kho</h1>
    
    <div class="container">
        <div class="upload-section">
            <h2>Upload Hóa Đơn</h2>
            
            <div class="upload-area" id="dropArea">
                <p>Kéo thả file PDF hóa đơn vào đây hoặc nhấn để chọn file</p>
                <input type="file" id="fileInput" accept=".pdf" style="display: none;">
            </div>
            
            <div id="invoiceInfo" class="invoice-info" style="display: none;">
                <h3>Thông Tin Hóa Đơn</h3>
                <p><strong>Số hóa đơn:</strong> <span id="invoiceNumber"></span></p>
                <p><strong>Ngày lập:</strong> <span id="invoiceDate"></span></p>
                <p><strong>Người bán:</strong> <span id="sellerName"></span></p>
                <p><strong>Người mua:</strong> <span id="buyerName"></span></p>
            </div>
            
            <button id="processBtn" disabled>Xử lý hóa đơn</button>
            <button id="saveBtn" disabled>Lưu vào hệ thống</button>
            
            <div id="status" class="status" style="display: none;"></div>
        </div>
        
        <div class="inventory-section">
            <h2>Quản Lý Tồn Kho</h2>
            
            <div class="search-box">
                <input type="text" id="searchInventory" placeholder="Tìm kiếm hàng hóa...">
                <button id="searchBtn">Tìm kiếm</button>
                <button id="exportBtn">Xuất báo cáo</button>
            </div>
            
            <table id="inventoryTable">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Mã hàng</th>
                        <th>Tên hàng hóa</th>
                        <th>Đơn vị</th>
                        <th>Số lượng</th>
                        <th>Đơn giá</th>
                        <th>Thuế suất</th>
                        <th>Tồn kho</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="inventoryList">
                    <!-- Dữ liệu tồn kho sẽ được thêm vào đây -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Thiết lập PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
        
        // Biến lưu trữ dữ liệu
        let extractedData = null;
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
        
        // DOM Elements
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const processBtn = document.getElementById('processBtn');
        const saveBtn = document.getElementById('saveBtn');
        const searchBtn = document.getElementById('searchBtn');
        const exportBtn = document.getElementById('exportBtn');
        const searchInventory = document.getElementById('searchInventory');
        
        // Sự kiện upload file
        dropArea.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                await processPDF(file);
            }
        });
        
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.style.backgroundColor = '#e3f2fd';
        });
        
        dropArea.addEventListener('dragleave', () => {
            dropArea.style.backgroundColor = '';
        });
        
        dropArea.addEventListener('drop', async (e) => {
            e.preventDefault();
            dropArea.style.backgroundColor = '';
            
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                fileInput.files = e.dataTransfer.files;
                await processPDF(file);
            } else {
                showStatus('Vui lòng chọn file PDF', 'error');
            }
        });
        
        // Xử lý file PDF
        async function processPDF(file) {
            showStatus('Đang xử lý file PDF...', '');
            
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                
                // Giả lập dữ liệu trích xuất từ PDF (trong thực tế cần dùng OCR hoặc API chuyên dụng)
                // Đây chỉ là ví dụ minh họa với dữ liệu mẫu
                extractedData = {
                    invoiceNumber: 'HD' + Math.floor(Math.random() * 10000),
                    invoiceDate: new Date().toLocaleDateString('vi-VN'),
                    sellerName: 'CHI NHÁNH CÔNG TY TNHH THƯƠNG MẠI ĐẶC HƯNG TẠI NINH THUẬN',
                    buyerName: 'TRẦN THỊ KHANH',
                    items: [
                        { code: 'PAN001', name: 'PAN DX 3PDK 300MLX12 BIOTIN NRT (03.23)', unit: 'Chai', quantity: 2, price: 101227, taxRate: 10, stock: 10 },
                        { code: 'DOW001', name: 'DOWNY 3LX4 HUYEN BI NXV TUI (12.24)', unit: 'Túi', quantity: 4, price: 202909, taxRate: 10, stock: 15 },
                        { code: 'DOW002', name: 'NG DOWNY 2.7KGX5 VHOA THOM NGAT (03.25)', unit: 'Túi', quantity: 5, price: 148082, taxRate: 10, stock: 8 },
                        { code: 'DOW003', name: 'DOWNY 18MLX360 DAY NANG MAI 10+2 (02.25)', unit: 'Dây', quantity: 1, price: 16227.3, taxRate: 10, stock: 20 }
                    ]
                };
                
                // Hiển thị thông tin hóa đơn
                document.getElementById('invoiceNumber').textContent = extractedData.invoiceNumber;
                document.getElementById('invoiceDate').textContent = extractedData.invoiceDate;
                document.getElementById('sellerName').textContent = extractedData.sellerName;
                document.getElementById('buyerName').textContent = extractedData.buyerName;
                document.getElementById('invoiceInfo').style.display = 'block';
                
                processBtn.disabled = false;
                showStatus('File PDF đã sẵn sàng để xử lý', 'success');
            } catch (error) {
                console.error('Error processing PDF:', error);
                showStatus('Lỗi khi xử lý file PDF', 'error');
            }
        }
        
        // Xử lý hóa đơn
        processBtn.addEventListener('click', () => {
            if (!extractedData) return;
            
            // Hiển thị dữ liệu trong bảng tồn kho (có thể chỉnh sửa)
            const inventoryList = document.getElementById('inventoryList');
            inventoryList.innerHTML = '';
            
            extractedData.items.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><input type="text" value="${item.code}" class="editable"></td>
                    <td><input type="text" value="${item.name}" class="editable"></td>
                    <td><input type="text" value="${item.unit}" class="editable"></td>
                    <td><input type="number" value="${item.quantity}" class="editable"></td>
                    <td><input type="number" value="${item.price}" class="editable"></td>
                    <td><input type="number" value="${item.taxRate}" class="editable">%</td>
                    <td><input type="number" value="${item.stock}" class="editable"></td>
                    <td>
                        <button class="update-btn" data-index="${index}">Cập nhật</button>
                    </td>
                `;
                inventoryList.appendChild(row);
            });
            
            saveBtn.disabled = false;
            showStatus('Dữ liệu hóa đơn đã sẵn sàng để lưu', 'success');
        });
        
        // Lưu vào hệ thống
        saveBtn.addEventListener('click', () => {
            if (!extractedData) return;
            
            // Cập nhật dữ liệu tồn kho
            const rows = document.querySelectorAll('#inventoryList tr');
            rows.forEach((row, index) => {
                const inputs = row.querySelectorAll('.editable');
                
                // Tìm sản phẩm trong kho
                const productCode = inputs[0].value;
                let product = inventory.find(p => p.code === productCode);
                
                if (product) {
                    // Cập nhật sản phẩm tồn tại
                    product.quantity += parseInt(inputs[3].value);
                    product.price = parseFloat(inputs[4].value);
                    product.stock = parseInt(inputs[6].value);
                } else {
                    // Thêm sản phẩm mới
                    product = {
                        code: productCode,
                        name: inputs[1].value,
                        unit: inputs[2].value,
                        quantity: parseInt(inputs[3].value),
                        price: parseFloat(inputs[4].value),
                        taxRate: parseFloat(inputs[5].value),
                        stock: parseInt(inputs[6].value)
                    };
                    inventory.push(product);
                }
            });
            
            // Lưu vào localStorage
            localStorage.setItem('inventory', JSON.stringify(inventory));
            
            showStatus('Dữ liệu đã được lưu vào hệ thống', 'success');
            renderInventory();
        });
        
        // Hiển thị tồn kho
        function renderInventory(filter = '') {
            const filteredInventory = filter 
                ? inventory.filter(item => 
                    item.name.toLowerCase().includes(filter.toLowerCase()) || 
                    item.code.toLowerCase().includes(filter.toLowerCase()))
                : inventory;
            
            const inventoryList = document.getElementById('inventoryList');
            inventoryList.innerHTML = '';
            
            filteredInventory.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.code}</td>
                    <td>${item.name}</td>
                    <td>${item.unit}</td>
                    <td>${item.quantity}</td>
                    <td>${item.price.toLocaleString()}</td>
                    <td>${item.taxRate}%</td>
                    <td>${item.stock}</td>
                    <td>
                        <button class="edit-btn" data-code="${item.code}">Sửa</button>
                        <button class="delete-btn" data-code="${item.code}">Xóa</button>
                    </td>
                `;
                inventoryList.appendChild(row);
            });
            
            // Thêm sự kiện cho nút sửa/xóa
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const code = this.getAttribute('data-code');
                    editProduct(code);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const code = this.getAttribute('data-code');
                    deleteProduct(code);
                });
            });
        }
        
        // Sửa sản phẩm
        function editProduct(code) {
            const product = inventory.find(p => p.code === code);
            if (!product) return;
            
            const newCode = prompt('Mã hàng:', product.code);
            if (newCode === null) return;
            
            const newName = prompt('Tên hàng hóa:', product.name);
            const newUnit = prompt('Đơn vị tính:', product.unit);
            const newPrice = prompt('Đơn giá:', product.price);
            const newTaxRate = prompt('Thuế suất (%):', product.taxRate);
            const newStock = prompt('Tồn kho:', product.stock);
            
            if (newName && newUnit && newPrice && newTaxRate && newStock) {
                product.code = newCode;
                product.name = newName;
                product.unit = newUnit;
                product.price = parseFloat(newPrice);
                product.taxRate = parseFloat(newTaxRate);
                product.stock = parseInt(newStock);
                
                localStorage.setItem('inventory', JSON.stringify(inventory));
                renderInventory();
                showStatus('Đã cập nhật sản phẩm', 'success');
            }
        }
        
        // Xóa sản phẩm
        function deleteProduct(code) {
            if (confirm('Bạn có chắc chắn muốn xóa sản phẩm này?')) {
                inventory = inventory.filter(p => p.code !== code);
                localStorage.setItem('inventory', JSON.stringify(inventory));
                renderInventory();
                showStatus('Đã xóa sản phẩm', 'success');
            }
        }
        
        // Tìm kiếm tồn kho
        searchBtn.addEventListener('click', () => {
            renderInventory(searchInventory.value);
        });
        
        searchInventory.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                renderInventory(searchInventory.value);
            }
        });
        
        // Xuất báo cáo
        exportBtn.addEventListener('click', () => {
            let csvContent = "Mã hàng,Tên hàng hóa,Đơn vị,Số lượng,Đơn giá,Thuế suất(%),Tồn kho\n";
            
            inventory.forEach(item => {
                csvContent += `${item.code},${item.name},${item.unit},${item.quantity},${item.price},${item.taxRate},${item.stock}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'bao_cao_ton_kho.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        // Hiển thị trạng thái
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
        }
        
        // Khởi tạo hiển thị tồn kho
        renderInventory();
    </script>
</body>
</html>
```

## Hướng Dẫn Sử Dụng

1. **Upload Hóa Đơn**:
   - Kéo thả file PDF hóa đơn vào vùng quy định hoặc nhấn để chọn file
   - Hệ thống sẽ trích xuất thông tin hóa đơn (số hóa đơn, ngày, người bán/mua)
   - Nhấn "Xử lý hóa đơn" để hiển thị chi tiết các mặt hàng

2. **Quản Lý Tồn Kho**:
   - Các mặt hàng từ hóa đơn sẽ được hiển thị trong bảng có thể chỉnh sửa
   - Nhấn "Lưu vào hệ thống" để cập nhật vào kho
   - Có thể tìm kiếm, sửa hoặc xóa sản phẩm trong kho
   - Xuất báo cáo tồn kho dạng CSV

3. **Tính Năng Chính**:
   - Đọc file PDF hóa đơn (giả lập - thực tế cần tích hợp OCR)
   - Tự động cập nhật số lượng tồn kho khi nhập hóa đơn
   - Chỉnh sửa thông tin sản phẩm trực tiếp trên bảng
   - Tìm kiếm và lọc sản phẩm trong kho
   - Xuất báo cáo tồn kho

**Lưu ý**: Trong thực tế, để trích xuất chính xác dữ liệu từ PDF, bạn cần tích hợp thêm:
1. Công nghệ OCR (như Tesseract.js)
2. Hoặc API chuyên dụng để đọc PDF có cấu trúc phức tạp
3. Kết nối với cơ sở dữ liệu thay vì localStorage để lưu trữ lâu dài