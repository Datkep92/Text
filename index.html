<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quét bài viết Facebook (cho iPhone)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea { width: 100%; height: 200px; font-size: 14px; margin-top: 10px; }
    button { padding: 10px 16px; font-size: 16px; margin-top: 10px; margin-right: 10px; }
    #output { white-space: pre-wrap; background: #f1f1f1; border: 1px solid #ccc; padding: 10px; margin-top: 20px; }
    code { background: #eee; padding: 2px 4px; }
  </style>
</head>
<body>

  <h2>Trích xuất bài viết Facebook (iPhone)</h2>

  <h3>Bước 1: Thêm Bookmarklet</h3>
  <p>Copy đoạn sau và tạo <b>bookmark</b> mới trong Safari (đặt tên là “Lấy HTML Facebook”):</p>
  <textarea readonly onclick="this.select()">
javascript:(function(){const html=document.documentElement.outerHTML;const w=window.open();w.document.write(`<textarea style='width:100%;height:100%'>${html}</textarea>`);})();
  </textarea>
  <p>Trên Facebook.com, bạn chỉ cần bấm bookmark này, trang sẽ mở toàn bộ HTML. Copy đoạn đó.</p>

  <h3>Bước 2: Dán mã HTML vào đây</h3>
  <textarea id="htmlInput" placeholder="Dán mã HTML từ Facebook..."></textarea>
  <br>
  <button onclick="extractLinks()">Quét bài viết</button>
  <button onclick="saveAsText()">Tải xuống .txt</button>

  <h3>Kết quả:</h3>
  <div id="output">Chưa có dữ liệu.</div>

  <script>
    let lastResult = '';

    function extractLinks() {
      const html = document.getElementById("htmlInput").value;
      const container = document.createElement("div");
      container.innerHTML = html;

      const links = new Set();
      const articles = container.querySelectorAll('article');

      articles.forEach(article => {
        const text = article.innerText || '';
        const isSponsored = /Sponsored|Được tài trợ/i.test(text);
        const a = article.querySelector('a[href*="/posts/"], a[href*="/story.php"], a[href*="/l.php"], a[href*="/ads/"]');

        if (a) {
          let href = a.getAttribute('href');
          if (!href.startsWith('http')) href = 'https://facebook.com' + href;
          links.add((isSponsored ? '[Ad] ' : '') + href);
        }
      });

      lastResult = Array.from(links).join('\n');
      document.getElementById("output").innerText = lastResult || 'Không tìm thấy bài viết nào.';
    }

    function saveAsText() {
      if (!lastResult) return alert('Chưa có dữ liệu để lưu!');
      const blob = new Blob([lastResult], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'facebook-links.txt';
      a.click();
    }
  </script>
</body>
</html>